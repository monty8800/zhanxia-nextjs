(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,31220,e=>{"use strict";var r=e.i(43476),t=e.i(71645),a=e.i(20755),s=e.i(18566),l=e.i(22016),i=e.i(11152);function d(){let e=(0,s.useRouter)(),d=(0,s.useParams)().id,[n,o]=(0,t.useState)(!0),[c,g]=(0,t.useState)(!1),[u,x]=(0,t.useState)(!1),[m,h]=(0,t.useState)(null),[b,p]=(0,t.useState)(""),[y,f]=(0,t.useState)({category:"",name:"",price:"",description:"",status:"已上架",sort_order:"0",image_url:""});(0,t.useEffect)(()=>{k()},[d]);let j=e=>{let r=e.target.files?.[0];if(r){if(!r.type.startsWith("image/"))return void alert("请选择图片文件");if(r.size>5242880)return void alert("图片大小不能超过 5MB");h(r);let e=new FileReader;e.onloadend=()=>{p(e.result)},e.readAsDataURL(r)}},v=async()=>{if(!m)return null;x(!0);try{let e=(0,a.createClient)(),r=m.name.split(".").pop(),t=`${Date.now()}-${Math.random().toString(36).substring(7)}.${r}`,s=`services/${t}`,{error:l}=await e.storage.from("service-images").upload(s,m);if(l)throw l;let{data:i}=e.storage.from("service-images").getPublicUrl(s);return i.publicUrl}catch(e){throw console.error("图片上传失败:",e),e}finally{x(!1)}},k=async()=>{try{let e=(0,a.createClient)(),{data:r,error:t}=await e.from("services").select("*").eq("id",d).single();if(t)throw t;f({category:r.category,name:r.name,price:r.price.toString(),description:r.description||"",status:r.status,sort_order:r.sort_order.toString(),image_url:r.image_url||""}),r.image_url&&p(r.image_url)}catch(r){alert("加载失败："+(r instanceof Error?r.message:"未知错误")),e.push("/admin/services")}finally{o(!1)}},w=async r=>{r.preventDefault(),g(!0);try{let r=y.image_url;if(m){let e=await v();e&&(r=e)}let t=(0,a.createClient)(),{error:s}=await t.from("services").update({category:y.category,name:y.name,price:parseInt(y.price),description:y.description,status:y.status,sort_order:parseInt(y.sort_order),image_url:r}).eq("id",d);if(s)throw s;alert("更新成功！"),e.push("/admin/services")}catch(e){alert("更新失败："+(e instanceof Error?e.message:"未知错误"))}finally{g(!1)}};return n?(0,r.jsxs)("div",{className:"flex justify-center items-center py-20",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-purple-500"}),(0,r.jsx)("span",{className:"ml-4 text-gray-400",children:"加载中..."})]}):(0,r.jsxs)("div",{className:"max-w-5xl mx-auto space-y-6",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("h1",{className:"text-3xl font-bold text-gray-800 dark:text-white",children:"编辑服务"}),(0,r.jsx)(l.default,{href:"/admin/services",className:"text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200",children:"返回列表"})]}),(0,r.jsxs)("form",{onSubmit:w,className:"space-y-6",children:[(0,r.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold text-gray-800 dark:text-white mb-4",children:"基本信息"}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:["服务分类 ",(0,r.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,r.jsx)("select",{value:y.category,onChange:e=>f({...y,category:e.target.value}),className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white",required:!0,children:["赌约单","护航保底","趣味单","摸红单","部门任务","赛季3x3","陪玩","保险单"].map(e=>(0,r.jsx)("option",{value:e,children:e},e))})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:["服务名称 ",(0,r.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,r.jsx)("input",{type:"text",value:y.name,onChange:e=>f({...y,name:e.target.value}),className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white",required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:["价格（元）",(0,r.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,r.jsx)("input",{type:"number",value:y.price,onChange:e=>f({...y,price:e.target.value}),className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white",min:"0",required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"状态"}),(0,r.jsxs)("select",{value:y.status,onChange:e=>f({...y,status:e.target.value}),className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white",children:[(0,r.jsx)("option",{value:"已上架",children:"已上架"}),(0,r.jsx)("option",{value:"已下架",children:"已下架"})]})]}),(0,r.jsxs)("div",{className:"md:col-span-2",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"排序顺序"}),(0,r.jsx)("input",{type:"number",value:y.sort_order,onChange:e=>f({...y,sort_order:e.target.value}),className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white",min:"0"}),(0,r.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:"数字越小越靠前"})]}),(0,r.jsxs)("div",{className:"md:col-span-2",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"服务描述"}),(0,r.jsx)("textarea",{value:y.description,onChange:e=>f({...y,description:e.target.value}),className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white",rows:4})]})]})]}),(0,r.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold text-gray-800 dark:text-white mb-4",children:"图片管理"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"服务图片"}),b?(0,r.jsxs)("div",{className:"relative w-full h-64 border-2 border-gray-300 dark:border-gray-600 rounded-lg overflow-hidden",children:[(0,r.jsx)("img",{src:b,alt:"预览",className:"w-full h-full object-contain"}),(0,r.jsx)("button",{type:"button",onClick:()=>{h(null),p("")},className:"absolute top-2 right-2 p-2 bg-red-600 text-white rounded-full hover:bg-red-700 transition",children:(0,r.jsx)(i.FaTimes,{})}),(0,r.jsxs)("label",{className:"absolute bottom-2 right-2 px-3 py-1 bg-blue-600 text-white text-sm rounded cursor-pointer hover:bg-blue-700 transition",children:["更换图片",(0,r.jsx)("input",{type:"file",className:"hidden",accept:"image/*",onChange:j})]})]}):(0,r.jsxs)("label",{className:"flex flex-col items-center justify-center w-full h-48 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-700 transition",children:[(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center pt-5 pb-6",children:[(0,r.jsx)(i.FaUpload,{className:"w-10 h-10 mb-3 text-gray-400"}),(0,r.jsxs)("p",{className:"mb-2 text-sm text-gray-500 dark:text-gray-400",children:[(0,r.jsx)("span",{className:"font-semibold",children:"点击上传图片"})," 或拖拽到这里"]}),(0,r.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"支持 PNG, JPG, WEBP, GIF (最大 5MB)"})]}),(0,r.jsx)("input",{type:"file",className:"hidden",accept:"image/*",onChange:j})]})]})]}),(0,r.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:(0,r.jsxs)("div",{className:"flex gap-4",children:[(0,r.jsx)("button",{type:"submit",disabled:c||u,className:"flex-1 px-6 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition disabled:opacity-50 disabled:cursor-not-allowed font-medium",children:u?"上传图片中...":c?"保存中...":"保存修改"}),(0,r.jsx)(l.default,{href:"/admin/services",className:"flex-1 px-6 py-3 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition text-center font-medium",children:"取消"})]})})]})]})}e.s(["default",()=>d,"runtime",0,"edge"])}]);