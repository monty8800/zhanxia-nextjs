(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,61449,e=>{"use strict";var r=e.i(43476),t=e.i(71645),a=e.i(20755),s=e.i(18566),l=e.i(22016),i=e.i(11152);function d(){let e=(0,s.useRouter)(),[d,n]=(0,t.useState)(!1),[o,c]=(0,t.useState)(!1),[g,u]=(0,t.useState)(null),[x,m]=(0,t.useState)(""),[h,y]=(0,t.useState)({category:"赌约单",name:"",price:"",description:"",status:"已上架",sort_order:"0",image_url:""}),b=async()=>{if(!g)return null;c(!0);try{let e=(0,a.createClient)(),r=g.name.split(".").pop(),t=`${Date.now()}-${Math.random().toString(36).substring(7)}.${r}`,s=`services/${t}`,{error:l}=await e.storage.from("service-images").upload(s,g);if(l)throw l;let{data:i}=e.storage.from("service-images").getPublicUrl(s);return i.publicUrl}catch(e){throw console.error("图片上传失败:",e),e}finally{c(!1)}},p=async r=>{r.preventDefault(),n(!0);try{let r=h.image_url;if(g){let e=await b();e&&(r=e)}let t=(0,a.createClient)(),{error:s}=await t.from("services").insert([{category:h.category,name:h.name,price:parseInt(h.price),description:h.description,status:h.status,sort_order:parseInt(h.sort_order),image_url:r}]);if(s)throw s;alert("添加成功！"),e.push("/admin/services")}catch(e){alert("添加失败："+(e instanceof Error?e.message:"未知错误"))}finally{n(!1)}};return(0,r.jsxs)("div",{className:"max-w-2xl mx-auto space-y-6",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("h1",{className:"text-3xl font-bold text-gray-800 dark:text-white",children:"添加服务"}),(0,r.jsx)(l.default,{href:"/admin/services",className:"text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200",children:"返回列表"})]}),(0,r.jsxs)("form",{onSubmit:p,className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6 space-y-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:["服务分类 ",(0,r.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,r.jsx)("select",{value:h.category,onChange:e=>y({...h,category:e.target.value}),className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white",required:!0,children:["赌约单","护航保底","趣味单","摸红单","部门任务","赛季3x3","陪玩","保险单"].map(e=>(0,r.jsx)("option",{value:e,children:e},e))})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:["服务名称 ",(0,r.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,r.jsx)("input",{type:"text",value:h.name,onChange:e=>y({...h,name:e.target.value}),className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white",placeholder:"例如：赌约体验单",required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:["价格（元）",(0,r.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,r.jsx)("input",{type:"number",value:h.price,onChange:e=>y({...h,price:e.target.value}),className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white",placeholder:"288",min:"0",required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"服务描述"}),(0,r.jsx)("textarea",{value:h.description,onChange:e=>y({...h,description:e.target.value}),className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white",placeholder:"服务详细描述...",rows:4})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"服务图片"}),x?(0,r.jsxs)("div",{className:"relative w-full h-48 border-2 border-gray-300 dark:border-gray-600 rounded-lg overflow-hidden",children:[(0,r.jsx)("img",{src:x,alt:"预览",className:"w-full h-full object-contain"}),(0,r.jsx)("button",{type:"button",onClick:()=>{u(null),m(""),y({...h,image_url:""})},className:"absolute top-2 right-2 p-2 bg-red-600 text-white rounded-full hover:bg-red-700 transition",children:(0,r.jsx)(i.FaTimes,{})})]}):(0,r.jsxs)("label",{className:"flex flex-col items-center justify-center w-full h-48 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-700 transition",children:[(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center pt-5 pb-6",children:[(0,r.jsx)(i.FaUpload,{className:"w-10 h-10 mb-3 text-gray-400"}),(0,r.jsxs)("p",{className:"mb-2 text-sm text-gray-500 dark:text-gray-400",children:[(0,r.jsx)("span",{className:"font-semibold",children:"点击上传图片"})," 或拖拽到这里"]}),(0,r.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"支持 PNG, JPG, WEBP, GIF (最大 5MB)"})]}),(0,r.jsx)("input",{type:"file",className:"hidden",accept:"image/*",onChange:e=>{let r=e.target.files?.[0];if(r){if(!r.type.startsWith("image/"))return void alert("请选择图片文件");if(r.size>5242880)return void alert("图片大小不能超过 5MB");u(r);let e=new FileReader;e.onloadend=()=>{m(e.result)},e.readAsDataURL(r)}}})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"状态"}),(0,r.jsxs)("select",{value:h.status,onChange:e=>y({...h,status:e.target.value}),className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white",children:[(0,r.jsx)("option",{value:"已上架",children:"已上架"}),(0,r.jsx)("option",{value:"已下架",children:"已下架"})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"排序顺序"}),(0,r.jsx)("input",{type:"number",value:h.sort_order,onChange:e=>y({...h,sort_order:e.target.value}),className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white",placeholder:"0",min:"0"}),(0,r.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:"数字越小越靠前"})]}),(0,r.jsxs)("div",{className:"flex gap-4",children:[(0,r.jsx)("button",{type:"submit",disabled:d||o,className:"flex-1 px-6 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition disabled:opacity-50 disabled:cursor-not-allowed",children:o?"上传图片中...":d?"保存中...":"保存"}),(0,r.jsx)(l.default,{href:"/admin/services",className:"px-6 py-3 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition text-center",children:"取消"})]})]})]})}e.s(["default",()=>d,"runtime",0,"edge"])}]);