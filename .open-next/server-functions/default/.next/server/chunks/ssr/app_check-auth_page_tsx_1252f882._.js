module.exports=[46357,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(69240);function e(){let[a,e]=(0,c.useState)(null),[f,g]=(0,c.useState)(null),[h,i]=(0,c.useState)(!0);return((0,c.useEffect)(()=>{!async function(){try{let a=(0,d.createClient)(),{data:{user:b},error:c}=await a.auth.getUser();if(e({user:b,error:c}),b){let{data:c,error:d}=await a.from("user_profiles").select("*").eq("user_id",b.id).single();g({profile:c,error:d})}}catch(a){console.error(a)}finally{i(!1)}}()},[]),h)?(0,b.jsx)("div",{className:"min-h-screen bg-gray-900 text-white flex items-center justify-center",children:(0,b.jsx)("div",{children:"加载中..."})}):(0,b.jsx)("div",{className:"min-h-screen bg-gray-900 text-white p-8",children:(0,b.jsxs)("div",{className:"max-w-4xl mx-auto space-y-6",children:[(0,b.jsx)("h1",{className:"text-3xl font-bold mb-8",children:"认证状态检查"}),(0,b.jsxs)("div",{className:"bg-gray-800 rounded-lg p-6 border border-gray-700",children:[(0,b.jsx)("h2",{className:"text-xl font-bold mb-4",children:"1. Supabase Auth 状态"}),a?.user?(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("p",{className:"text-green-400",children:"✅ 已登录"}),(0,b.jsxs)("div",{className:"bg-gray-900 p-4 rounded",children:[(0,b.jsxs)("p",{children:[(0,b.jsx)("strong",{children:"用户ID:"})," ",a.user.id]}),(0,b.jsxs)("p",{children:[(0,b.jsx)("strong",{children:"邮箱:"})," ",a.user.email]}),(0,b.jsxs)("p",{children:[(0,b.jsx)("strong",{children:"创建时间:"})," ",new Date(a.user.created_at).toLocaleString()]})]})]}):(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-red-400",children:"❌ 未登录"}),a?.error&&(0,b.jsxs)("p",{className:"text-sm text-red-300 mt-2",children:["错误: ",a.error.message]}),(0,b.jsx)("a",{href:"/login",className:"inline-block mt-4 px-4 py-2 bg-purple-600 rounded",children:"去登录"})]})]}),a?.user&&(0,b.jsxs)("div",{className:"bg-gray-800 rounded-lg p-6 border border-gray-700",children:[(0,b.jsx)("h2",{className:"text-xl font-bold mb-4",children:"2. User Profile 状态"}),f?.profile?(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("p",{className:"text-green-400",children:"✅ 配置存在"}),(0,b.jsxs)("div",{className:"bg-gray-900 p-4 rounded",children:[(0,b.jsxs)("p",{children:[(0,b.jsx)("strong",{children:"角色 (role):"}),(0,b.jsx)("span",{className:`ml-2 px-2 py-1 rounded ${"admin"===f.profile.role?"bg-green-600":"bg-yellow-600"}`,children:f.profile.role})]}),(0,b.jsxs)("p",{children:[(0,b.jsx)("strong",{children:"显示名称:"})," ",f.profile.display_name||"未设置"]}),(0,b.jsxs)("p",{children:[(0,b.jsx)("strong",{children:"邮箱:"})," ",f.profile.email]})]}),"admin"!==f.profile.role&&(0,b.jsxs)("div",{className:"mt-4 p-4 bg-yellow-900/30 border border-yellow-500/50 rounded",children:[(0,b.jsx)("p",{className:"text-yellow-400 font-bold",children:"⚠️ 当前角色不是管理员"}),(0,b.jsx)("p",{className:"text-sm mt-2",children:"需要在 Supabase 中执行以下 SQL："}),(0,b.jsx)("pre",{className:"mt-2 p-3 bg-gray-900 rounded text-xs overflow-x-auto",children:`UPDATE user_profiles 
SET role = 'admin' 
WHERE user_id = '${a.user.id}';`})]}),"admin"===f.profile.role&&(0,b.jsxs)("div",{className:"mt-4 p-4 bg-green-900/30 border border-green-500/50 rounded",children:[(0,b.jsx)("p",{className:"text-green-400 font-bold",children:"✅ 是管理员，可以访问管理后台"}),(0,b.jsx)("a",{href:"/admin",className:"inline-block mt-2 px-4 py-2 bg-purple-600 rounded",children:"进入管理后台"})]})]}):(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-red-400",children:"❌ 用户配置不存在"}),f?.error&&(0,b.jsxs)("p",{className:"text-sm text-red-300 mt-2",children:["错误: ",f.error.message]}),(0,b.jsxs)("div",{className:"mt-4 p-4 bg-red-900/30 border border-red-500/50 rounded",children:[(0,b.jsx)("p",{className:"font-bold",children:"问题：user_profiles 表中没有此用户的记录"}),(0,b.jsx)("p",{className:"text-sm mt-2",children:"可能原因："}),(0,b.jsxs)("ul",{className:"list-disc list-inside text-sm mt-2 space-y-1",children:[(0,b.jsx)("li",{children:"触发器未正确创建"}),(0,b.jsx)("li",{children:"用户注册时出错"}),(0,b.jsx)("li",{children:"需要手动插入记录"})]}),(0,b.jsx)("p",{className:"text-sm mt-4",children:"手动创建记录的 SQL："}),(0,b.jsx)("pre",{className:"mt-2 p-3 bg-gray-900 rounded text-xs overflow-x-auto",children:`INSERT INTO user_profiles (user_id, email, display_name, role)
VALUES (
  '${a.user.id}',
  '${a.user.email}',
  '${a.user.email?.split("@")[0]}',
  'admin'
)
ON CONFLICT (user_id) DO UPDATE SET role = 'admin';`})]})]})]}),(0,b.jsxs)("div",{className:"bg-gray-800 rounded-lg p-6 border border-gray-700",children:[(0,b.jsx)("h2",{className:"text-xl font-bold mb-4",children:"3. 解决方案"}),(0,b.jsxs)("div",{className:"space-y-4 text-sm",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"font-bold text-purple-400 mb-2",children:"方案 A：手动设置管理员权限（推荐）"}),(0,b.jsxs)("ol",{className:"list-decimal list-inside space-y-2 ml-4",children:[(0,b.jsx)("li",{children:"复制上面的 SQL 语句"}),(0,b.jsxs)("li",{children:["访问 Supabase SQL Editor:",(0,b.jsx)("a",{href:"https://supabase.com/dashboard/project/kkfjnzdndotqhieeukuk/sql/new",target:"_blank",className:"text-blue-400 underline ml-1",children:"打开"})]}),(0,b.jsx)("li",{children:"执行 SQL 语句"}),(0,b.jsx)("li",{children:"刷新此页面验证"})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"font-bold text-purple-400 mb-2",children:"方案 B：检查触发器"}),(0,b.jsx)("p",{className:"ml-4",children:"确保 add-auth-tables.sql 已完整执行，包括触发器部分"})]})]})]}),(0,b.jsxs)("div",{className:"flex gap-4",children:[(0,b.jsx)("a",{href:"/",className:"px-4 py-2 bg-gray-700 rounded hover:bg-gray-600",children:"返回首页"}),(0,b.jsx)("a",{href:"/login",className:"px-4 py-2 bg-purple-600 rounded hover:bg-purple-700",children:"登录页面"}),a?.user&&f?.profile?.role==="admin"&&(0,b.jsx)("a",{href:"/admin",className:"px-4 py-2 bg-green-600 rounded hover:bg-green-700",children:"管理后台"})]})]})})}a.s(["default",()=>e])}];

//# sourceMappingURL=app_check-auth_page_tsx_1252f882._.js.map